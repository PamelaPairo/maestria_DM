<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pamela Eugenia Pairo">

<title>Regresión Logística</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="regLogistica_files/libs/clipboard/clipboard.min.js"></script>
<script src="regLogistica_files/libs/quarto-html/quarto.js"></script>
<script src="regLogistica_files/libs/quarto-html/popper.min.js"></script>
<script src="regLogistica_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="regLogistica_files/libs/quarto-html/anchor.min.js"></script>
<link href="regLogistica_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="regLogistica_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="regLogistica_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="regLogistica_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="regLogistica_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#presentación-del-caso-de-estudio" id="toc-presentación-del-caso-de-estudio" class="nav-link active" data-scroll-target="#presentación-del-caso-de-estudio">Presentación del caso de estudio</a></li>
  <li><a href="#creación-de-base-de-datos" id="toc-creación-de-base-de-datos" class="nav-link" data-scroll-target="#creación-de-base-de-datos">Creación de base de datos</a>
  <ul class="collapse">
  <li><a href="#partición-de-la-base-de-datos" id="toc-partición-de-la-base-de-datos" class="nav-link" data-scroll-target="#partición-de-la-base-de-datos">Partición de la base de datos</a></li>
  </ul></li>
  <li><a href="#regresión-lineal" id="toc-regresión-lineal" class="nav-link" data-scroll-target="#regresión-lineal">Regresión lineal</a></li>
  <li><a href="#recap-de-regresión-logística" id="toc-recap-de-regresión-logística" class="nav-link" data-scroll-target="#recap-de-regresión-logística">Recap de Regresión Logística</a>
  <ul class="collapse">
  <li><a href="#odds" id="toc-odds" class="nav-link" data-scroll-target="#odds"><strong>Odds</strong></a></li>
  <li><a href="#logit" id="toc-logit" class="nav-link" data-scroll-target="#logit"><strong>Logit</strong></a></li>
  <li><a href="#odds-ratio-or" id="toc-odds-ratio-or" class="nav-link" data-scroll-target="#odds-ratio-or"><strong><em>Odds Ratio</em> (OR)</strong></a></li>
  <li><a href="#escalas-de-análisis" id="toc-escalas-de-análisis" class="nav-link" data-scroll-target="#escalas-de-análisis">Escalas de análisis</a></li>
  </ul></li>
  <li><a href="#regresión-logística" id="toc-regresión-logística" class="nav-link" data-scroll-target="#regresión-logística">Regresión Logística</a>
  <ul class="collapse">
  <li><a href="#interpretación-de-los-coeficientes-del-modelo" id="toc-interpretación-de-los-coeficientes-del-modelo" class="nav-link" data-scroll-target="#interpretación-de-los-coeficientes-del-modelo">Interpretación de los coeficientes del modelo</a>
  <ul class="collapse">
  <li><a href="#devianza" id="toc-devianza" class="nav-link" data-scroll-target="#devianza">Devianza</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#selección-de-modelos" id="toc-selección-de-modelos" class="nav-link" data-scroll-target="#selección-de-modelos">Selección de modelos</a>
  <ul class="collapse">
  <li><a href="#evaluando-los-modelos-en-train" id="toc-evaluando-los-modelos-en-train" class="nav-link" data-scroll-target="#evaluando-los-modelos-en-train">Evaluando los modelos en train</a></li>
  <li><a href="#buscando-el-umbral" id="toc-buscando-el-umbral" class="nav-link" data-scroll-target="#buscando-el-umbral">Buscando el umbral</a></li>
  <li><a href="#evaluando-en-test" id="toc-evaluando-en-test" class="nav-link" data-scroll-target="#evaluando-en-test">Evaluando en test</a>
  <ul class="collapse">
  <li><a href="#gráfico-de-hosmer-lemeshow" id="toc-gráfico-de-hosmer-lemeshow" class="nav-link" data-scroll-target="#gráfico-de-hosmer-lemeshow">Gráfico de Hosmer Lemeshow</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Regresión Logística</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Mostrar todo el código</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Ocultar todo el código</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Ver el código fuente</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor/a</div>
    <div class="quarto-title-meta-contents">
             <p>Pamela Eugenia Pairo </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargamos las librerías que vamos a utilizar</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(OneR)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">15</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="presentación-del-caso-de-estudio" class="level1">
<h1>Presentación del caso de estudio</h1>
<p>Vamos a trabajar con una base de datos extraída de <a href="https://www.kaggle.com/code/robinreni/cardiovascular-disease-eda-detailed/notebook">Kaggle</a>. Es una base de datos que consiste de 69301 registros de pacientes a los que se les registró 12 caracteristicas asociadas a una enfermedad cardiovascular.</p>
<p>El objetivo de esta clase es utilizar diferentes modelos de regresión logística para predecir la presencia o ausencia de enfermedad cardiovascular (ECV) utilizando los resultados del examen del paciente.</p>
<p><strong>Descripción de los datos</strong></p>
<ul>
<li>Age: edad del paciente (días)</li>
<li>Height: altura del paciente (cm)</li>
<li>Weight: peso del paciente (kg)</li>
<li>Gender: sexo biológio del paciente (1: mujer, 2:varón)</li>
<li>Systolic blood pressure: Presión arterial sistólica</li>
<li>Diastolic blood pressure: Presión arterial diastólica</li>
<li>Cholesterol: colesterol en sangre del paciente (1: normal, 2: por encima de lo normal, 3: muy por encima de lo normal)</li>
<li>Glucose: glucosa (1: normal, 2: por encima de lo normal, 3: muy por encima de lo normal)</li>
<li>Smoking: fuma/no fuma</li>
<li>Alcohol intake: consume alcohol/ no consume alcohol</li>
<li>Physical activity; realiza actividad física/ no realiza actividad física</li>
<li>Cardiovascular disease: variable target (0:no, 1:si)</li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"cardio_train.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(df))<span class="co"># chequeamos si hay datos faltantes</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         id         age      gender      height      weight       ap_hi 
          0           0           0           0           0           0 
      ap_lo cholesterol        gluc       smoke        alco      active 
          0           0           0           0           0           0 
     cardio 
          0 </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">duplicated</span>(df))<span class="co">#chequeamos duplicados</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 70,000
Columns: 13
$ id          &lt;int&gt; 0, 1, 2, 3, 4, 8, 9, 12, 13, 14, 15, 16, 18, 21, 23, 24, 2…
$ age         &lt;int&gt; 18393, 20228, 18857, 17623, 17474, 21914, 22113, 22584, 17…
$ gender      &lt;int&gt; 2, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 2, 1, 2, 2, 1, 1, 1, 2…
$ height      &lt;int&gt; 168, 156, 165, 169, 156, 151, 157, 178, 158, 164, 169, 173…
$ weight      &lt;dbl&gt; 62, 85, 64, 82, 56, 67, 93, 95, 71, 68, 80, 60, 60, 78, 95…
$ ap_hi       &lt;int&gt; 110, 140, 130, 150, 100, 120, 130, 130, 110, 110, 120, 120…
$ ap_lo       &lt;int&gt; 80, 90, 70, 100, 60, 80, 80, 90, 70, 60, 80, 80, 80, 70, 9…
$ cholesterol &lt;int&gt; 1, 3, 3, 1, 1, 2, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ gluc        &lt;int&gt; 1, 1, 1, 1, 1, 2, 1, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1…
$ smoke       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1…
$ alco        &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0…
$ active      &lt;int&gt; 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1…
$ cardio      &lt;int&gt; 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0…</code></pre>
</div>
</div>
</section>
<section id="creación-de-base-de-datos" class="level1">
<h1>Creación de base de datos</h1>
<p>Se genera una muestra de tamaño 1000 con la que se realizaran los análisis y se analiza si hay desbalance en la variable respuesta.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sample_n</span>(<span class="dv">1000</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cardio) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cnt =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq =</span> <span class="fu">round</span>(cnt <span class="sc">/</span> <span class="fu">sum</span>(cnt), <span class="dv">2</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  cardio   cnt  freq
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
1      0   512  0.51
2      1   488  0.49</code></pre>
</div>
</div>
<section id="partición-de-la-base-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="partición-de-la-base-de-datos">Partición de la base de datos</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(df,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>train<span class="ot">&lt;-</span> df_split <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">training</span>()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> df_split <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">testing</span>()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de datos en train</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Total del dataset de entrenamiento: "</span>, <span class="fu">nrow</span>(train))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Total del dataset de entrenamiento: 800"</code></pre>
</div>
</div>
<p>Analizamos cómo quedo el balance de clases para <code>cardio</code> en cada dataset.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculamos la distribución de clase en cada dataset</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>train_ <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cardio) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">numero_casos=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(numero_casos)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>test_ <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cardio) <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">numero_casos=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(numero_casos)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># armamos tabla conjunta para graficar</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>distrib <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">rbind</span>(train_, test_), <span class="at">dataset =</span> <span class="fu">c</span>(<span class="st">"train"</span>, <span class="st">"train"</span>, <span class="st">"test"</span>, <span class="st">"test"</span>))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># graficamos las distribuciones</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(distrib, <span class="fu">aes</span>(<span class="at">x =</span> cardio, <span class="at">y =</span> prop, <span class="at">fill =</span> <span class="fu">factor</span>(cardio), <span class="at">label =</span> prop)) <span class="sc">+</span> </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> dataset) <span class="sc">+</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Proporción en %"</span>, <span class="at">title =</span> <span class="st">"Proporción de cardio por dataset"</span>) <span class="sc">+</span> </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill=</span><span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">"cardio"</span>))<span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">"Set2"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regLogistica_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(train)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 800
Columns: 13
$ id          &lt;int&gt; 56139, 22387, 68567, 99348, 82747, 34471, 6559, 95883, 513…
$ age         &lt;int&gt; 23106, 14799, 20578, 18994, 14463, 20587, 14849, 15050, 16…
$ gender      &lt;int&gt; 1, 2, 1, 1, 1, 2, 2, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ height      &lt;int&gt; 152, 171, 168, 163, 157, 168, 172, 158, 164, 169, 160, 155…
$ weight      &lt;dbl&gt; 74, 72, 62, 104, 52, 70, 75, 50, 64, 65, 76, 90, 56, 89, 5…
$ ap_hi       &lt;int&gt; 160, 120, 120, 130, 110, 150, 120, 120, 100, 110, 130, 130…
$ ap_lo       &lt;int&gt; 100, 90, 80, 79, 70, 100, 90, 80, 70, 80, 70, 100, 60, 90,…
$ cholesterol &lt;int&gt; 2, 1, 1, 1, 2, 1, 2, 1, 1, 2, 2, 2, 1, 1, 2, 1, 1, 1, 2, 1…
$ gluc        &lt;int&gt; 2, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 3, 1, 1, 1, 1, 1, 1, 2, 1…
$ smoke       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ alco        &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ active      &lt;int&gt; 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1…
$ cardio      &lt;int&gt; 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1…</code></pre>
</div>
</div>
<p>Seleccioamos las variables con las que vamos a trabajar y les asignamos el tipo de dato correspondiente.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">"height"</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">"weight"</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">"gender"</span>, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"cholesterol"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"gluc"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"cardio"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>train<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train<span class="sc">$</span>gender)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>train<span class="sc">$</span>cholesterol <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train<span class="sc">$</span>cholesterol)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>train<span class="sc">$</span>gluc <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train<span class="sc">$</span>gluc)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test<span class="sc">$</span>gender)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>cholesterol <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test<span class="sc">$</span>cholesterol)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>gluc <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test<span class="sc">$</span>gluc)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># graficamos con ggpairs coloreando por variable a predecir</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cardio =</span> <span class="fu">factor</span>(cardio)) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="fu">all_of</span>(cols)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggpairs</span>(<span class="at">title =</span> <span class="st">"Correlograma de variables"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">colour=</span> cardio),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">progress =</span> <span class="cn">FALSE</span>, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">lower=</span><span class="fu">list</span>(<span class="at">combo=</span><span class="fu">wrap</span>(<span class="st">"facethist"</span>, <span class="at">binwidth=</span><span class="fl">0.8</span>))) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_brewer</span>(<span class="at">palette=</span><span class="st">"Set2"</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regLogistica_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="regresión-lineal" class="level1">
<h1>Regresión lineal</h1>
<p>En este caso estamos modelando la probabilidad de la siguiente manera:</p>
<p><span class="math inline">\(P(X)= \beta_0 + \sum\limits_{j=1}^p \beta_j X_j\)</span></p>
<p>Veamos que tan bueno es el modelo lineal para esto, usando el peso como predictor.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mrl <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">lm</span>(<span class="at">formula =</span> cardio <span class="sc">~</span> weight) </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>tdy <span class="ot">=</span> mrl <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>tdy</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept) -0.131     0.0880      -1.49 1.38e- 1
2 weight       0.00845   0.00117      7.19 1.48e-12</code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mrl <span class="sc">%&gt;%</span> <span class="fu">glance</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 12
  r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC
      &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    0.0609        0.0597 0.485      51.7 1.48e-12     1  -555. 1117. 1131.
# ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
</div>
<p>Los estimadores son significativos y el test de significatividad global del modelo también es significativo.</p>
<p>Veamos un gráfico de nuestro modelo.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regLogistica_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Parece tener bastantes problemas para estimar la probabilidad de supervivencia de los individuo: no existe un punto de corte claro, la predicción podría ser mayor a 1 o menor a cero llegado el caso.</p>
</section>
<section id="recap-de-regresión-logística" class="level1">
<h1>Recap de Regresión Logística</h1>
<section id="odds" class="level2">
<h2 class="anchored" data-anchor-id="odds"><strong>Odds</strong></h2>
<p>Cociente entre la probabilidad de éxito de un evento y la probabilidad de que no ocurra.</p>
<p><span class="math inline">\(Odds = \frac{P(x)}{1-P(x)}\)</span></p>
<p>Ej. si <em>Odds</em> es 3 indica que por cada 4 repeticiones del evento se espera que ocurran 3 y que una no ocurra.</p>
<p>Odds &lt; 1 : es mas probable que no ocurra a que si</p>
<p>Odds = 1 : equiprobabilidad</p>
<p>Odds &gt; 1: es mas probable que el evento ocurra a que no.</p>
<p>En nuestro caso:</p>
<p><span class="math inline">\(Odds = \frac{391/800}{409/800}= 0.9558 \approx \frac{191}{200}\)</span></p>
<p>Por cada 191 pacientes con ECV, 200 no la tienen.</p>
</section>
<section id="logit" class="level2">
<h2 class="anchored" data-anchor-id="logit"><strong>Logit</strong></h2>
<p><span class="math inline">\(Logit = \log {\frac{P(x)}{1-P(x)}}= \log Odds\)</span></p>
</section>
<section id="odds-ratio-or" class="level2">
<h2 class="anchored" data-anchor-id="odds-ratio-or"><strong><em>Odds Ratio</em> (OR)</strong></h2>
<p>Es una medida de magnitud de efecto. Si tenemos el siguiente modelo de regresión logística</p>
<p><span class="math inline">\(\log\left(\frac{p}{1 - p}\right) = \beta_0 + \beta_1 X\)</span></p>
<p>El odds ratio asociado a la variable <span class="math inline">\(\ X\)</span> es:</p>
<p><span class="math inline">\(\text{OR} = e^{\beta_1}\)</span></p>
<p>OR = 1 No hay efecto</p>
<p>OR &gt; 1 asociación positiva</p>
<p>OR &lt; 1 asociación negativa</p>
</section>
<section id="escalas-de-análisis" class="level2">
<h2 class="anchored" data-anchor-id="escalas-de-análisis">Escalas de análisis</h2>
<p>1- Predictor lineal</p>
<p>2- Odds</p>
<p>3- Variable respuesta</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="rl.png" class="img-fluid figure-img"></p>
<figcaption>Imagen adaptada de la clase de RL de Adriana Perez</figcaption>
</figure>
</div>
</section>
</section>
<section id="regresión-logística" class="level1">
<h1>Regresión Logística</h1>
<p>Para evitar los problemas vistos con regresión lineal, usamos la <strong>función logística</strong>.</p>
<p><span class="math inline">\(P(Y=1|X)= \frac{e^{\beta_0 + \sum\limits_{j=1}^p \beta_j X_j}}{1+e^{\beta_0 + \sum\limits_{j=1}^p \beta_j X_j}}\)</span></p>
<p>Esta función acota el resultado entre 0 y 1, lo cual es mucho más adecuado para modelar una probabilidad.</p>
<p>Luego de hacer algunas operaciones, podemos llegar a la expresión:</p>
<p><span class="math inline">\(\log {\frac{P(x)}{1-P(x)}}= \beta_0 + \sum\limits_{j=1}^p \beta_j X_j\)</span></p>
<p>La funcíón <code>glm()</code> nos permite crear un modelo lineal generalizado (Generalized Linear Model). Al igual que la función <code>lm()</code> toma como argumentos una <strong>formula</strong> y los <strong>datos</strong> pero también se debe especificar el argumento <strong>family</strong>: indicamos la distribución del error y la función link que vamos a utilizar en el modelo.</p>
<p>Algunas familias son:</p>
<ul>
<li><p><em>Binomial</em>: link=logit</p></li>
<li><p><em>Poisson</em>: link=log</p></li>
<li><p><em>Gaussiana</em>: link=identidad</p></li>
</ul>
<p>Como estamos trabajando con un fenómeno que suponemos tiene una distribución binomial, así lo especificamos en el parámetro <strong>family</strong>.</p>
<p>Realizamos un modelo de regresión logística para predecir la si el paciente tiene una ECV en función de <strong>weight</strong> y <strong>gender</strong>.</p>
<p><span class="math inline">\(\log {\frac{P(x)}{1-P(x)}}= \beta_0 + \beta_1 weight + \beta_2 age + \beta_2 varón\)</span></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo de regresión logística </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>glm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> train,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>            cardio <span class="sc">~</span> weight <span class="sc">+</span> gender, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># veo los resultados</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(glm1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  -2.71     0.402       -6.75 1.45e-11
2 weight        0.0373   0.00547      6.82 8.87e-12
3 gender2      -0.203    0.159       -1.27 2.02e- 1</code></pre>
</div>
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(glm1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
          &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
1         1109.     799  -528. 1063. 1077.    1057.         797   800</code></pre>
</div>
</div>
<section id="interpretación-de-los-coeficientes-del-modelo" class="level2">
<h2 class="anchored" data-anchor-id="interpretación-de-los-coeficientes-del-modelo">Interpretación de los coeficientes del modelo</h2>
<p>Modelo estimado</p>
<p><span class="math inline">\(\log {\frac{P(x)}{1-P(x)}}= -2.71 + 0.03* weight - 0.2*varón\)</span></p>
<p><strong>Peso</strong></p>
<p>Se espera un aumento de 0.03 unidades en el log de odds por cada aumento de 1kgr en el peso (manteniendo el resto de las variables constantes). La probabilidad de contraer una ECV aumenta con el aumento de peso del paciente.</p>
<p><span class="math inline">\(\ OR = e^{\beta_{weight}}= e^{0.03}= 1.03\)</span></p>
<p>Por cada aumento de 1 kgr se estima que el odds de contraer una ECV aumente 3.05%</p>
<p><strong>Género</strong></p>
<p><span class="math inline">\(\ Odds_{varón} = {\frac{Prob_{ECV} /varón}{Prob_{noECV}/varón}}\)</span></p>
<p><span class="math inline">\(\ Odds_{mujer} = {\frac{Prob_{ECV} /mujer}{Prob_{noECV}/mujer}}\)</span></p>
<p><span class="math inline">\(\ OR = {\frac{Odds_{varón}}{Odds_{mujer}}}= e^{\beta_{género}}= e^{-0.02}\)</span></p>
<p>El odds ratio para la variable género es 0.98, lo que indica que los varones tienen un 2 % menos de odds de presentar una ECV que las mujeres, manteniendo constante el peso. En consecuencia, ser mujer se asocia con un riesgo mayor riesgo relativo de ECV.</p>
<section id="devianza" class="level3">
<h3 class="anchored" data-anchor-id="devianza">Devianza</h3>
<p>Es una medida de la falta de ajuste del modelo. Cuanto menor es la devianza residual, mejor se ajusta el modelo.</p>
<p><span class="math inline">\(\ Devianza Explicada = {\frac{Dev_{mod null} - Dev_{Mod}}{Dev_{mod null}}}\)</span></p>
<p><span class="math inline">\(\ Devianza Explicada = {\frac{1108.71 - 1056.63}{1108.71}}= 0.046\)</span></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> (glm1<span class="sc">$</span>deviance <span class="sc">/</span> glm1<span class="sc">$</span>null.deviance)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.04698285</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="selección-de-modelos" class="level1">
<h1>Selección de modelos</h1>
<p>Se generan la combinación de todos los modelos posibles a partir de las variables <code>gender</code>, <code>weight</code>, y <code>cholesterol</code>. Antes hacemos un boxplot con <code>weight</code>, <code>cholesterol</code> y <code>cardio</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x =</span> cholesterol, <span class="at">y =</span> weight, <span class="at">fill =</span> <span class="fu">factor</span>(cardio))) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"cholesterol"</span>, <span class="at">y =</span> <span class="st">"Peso"</span>, <span class="at">fill =</span> <span class="st">"cardio"</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">"Set2"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regLogistica_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gender"</span>, </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">"weight"</span>, </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">"cholesterol"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear todas las combinaciones posibles de predictores</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>combs <span class="ot">&lt;-</span> <span class="fu">unlist</span>(</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(vars), <span class="cf">function</span>(i) <span class="fu">combn</span>(vars, i, <span class="at">simplify =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">recursive =</span> <span class="cn">FALSE</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una lista de fórmulas</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>formulas <span class="ot">&lt;-</span> <span class="fu">map</span>(combs, <span class="sc">~</span> <span class="fu">reformulate</span>(<span class="at">termlabels =</span> .x, <span class="at">response =</span> <span class="st">"cardio"</span>))</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>formulas</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
cardio ~ gender
&lt;environment: 0x00000140d766ffb8&gt;

[[2]]
cardio ~ weight
&lt;environment: 0x00000140d6f77358&gt;

[[3]]
cardio ~ cholesterol
&lt;environment: 0x00000140d0188848&gt;

[[4]]
cardio ~ gender + weight
&lt;environment: 0x00000140ccfa5808&gt;

[[5]]
cardio ~ gender + cholesterol
&lt;environment: 0x00000140ccf8ab20&gt;

[[6]]
cardio ~ weight + cholesterol
&lt;environment: 0x00000140d75199c8&gt;

[[7]]
cardio ~ gender + weight + cholesterol
&lt;environment: 0x00000140d7430a08&gt;</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#se realizan las regresiones logisticas para todos los modelos</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">&lt;-</span> <span class="fu">map</span>(formulas, <span class="sc">~</span> <span class="fu">glm</span>(.x, <span class="at">data =</span> train, <span class="at">family =</span> binomial))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="evaluando-los-modelos-en-train" class="level2">
<h2 class="anchored" data-anchor-id="evaluando-los-modelos-en-train">Evaluando los modelos en train</h2>
<p>Analizamos la performance de los modelos generados</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">map_chr</span>(formulas, format),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">deviance =</span> <span class="fu">map_dbl</span>(modelos, <span class="sc">~</span> .<span class="sc">$</span>deviance),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">null_deviance =</span> <span class="fu">map_dbl</span>(modelos, <span class="sc">~</span> .<span class="sc">$</span>null.deviance),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">map_dbl</span>(modelos, AIC)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dev_explicada =</span> <span class="dv">1</span> <span class="sc">-</span> deviance <span class="sc">/</span> null_deviance)<span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dev_explicada))<span class="co"># se ordena segñun devianza explicada</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>resultados</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
  formula                             deviance null_deviance   AIC dev_explicada
  &lt;chr&gt;                                  &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
1 cardio ~ gender + weight + cholest…    1037.         1109. 1047.     0.0644   
2 cardio ~ weight + cholesterol          1038.         1109. 1046.     0.0637   
3 cardio ~ gender + weight               1057.         1109. 1063.     0.0470   
4 cardio ~ weight                        1058.         1109. 1062.     0.0455   
5 cardio ~ gender + cholesterol          1080.         1109. 1088.     0.0262   
6 cardio ~ cholesterol                   1080.         1109. 1086.     0.0262   
7 cardio ~ gender                        1109.         1109. 1113.     0.0000850</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>prediction_full <span class="ot">&lt;-</span> <span class="fu">map2</span>(modelos, formulas, <span class="sc">~</span> {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fitted =</span> <span class="fu">predict</span>(.x, <span class="at">newdata =</span> train, <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cardio =</span> train<span class="sc">$</span>cardio</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>roc_df <span class="ot">&lt;-</span> <span class="fu">map2_dfr</span>(modelos, resultados<span class="sc">$</span>formula, <span class="sc">~</span> {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(train<span class="sc">$</span>cardio, <span class="fu">predict</span>(.x, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr =</span> roc_obj<span class="sc">$</span>sensitivities,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fpr =</span> <span class="dv">1</span> <span class="sc">-</span> roc_obj<span class="sc">$</span>specificities,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> .y</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(roc_df, <span class="fu">aes</span>(<span class="at">x =</span> fpr, <span class="at">y =</span> tpr, <span class="at">color =</span> formula)) <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"1 - Especificidad"</span>, <span class="at">y =</span> <span class="st">"Sensibilidad"</span>, <span class="at">title =</span> <span class="st">"Curvas ROC de todos los modelos"</span>) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regLogistica_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>auc_values <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(modelos, <span class="sc">~</span> <span class="fu">auc</span>(<span class="fu">roc</span>(train<span class="sc">$</span>cardio, <span class="fu">predict</span>(.x, <span class="at">type =</span> <span class="st">"response"</span>))))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> resultados <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AUC =</span> auc_values)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>resultados</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 6
  formula                       deviance null_deviance   AIC dev_explicada   AUC
  &lt;chr&gt;                            &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;
1 cardio ~ gender + weight + c…    1037.         1109. 1047.     0.0644    0.505
2 cardio ~ weight + cholesterol    1038.         1109. 1046.     0.0637    0.644
3 cardio ~ gender + weight         1057.         1109. 1063.     0.0470    0.581
4 cardio ~ weight                  1058.         1109. 1062.     0.0455    0.648
5 cardio ~ gender + cholesterol    1080.         1109. 1088.     0.0262    0.576
6 cardio ~ cholesterol             1080.         1109. 1086.     0.0262    0.665
7 cardio ~ gender                  1109.         1109. 1113.     0.0000850 0.667</code></pre>
</div>
</div>
</section>
<section id="buscando-el-umbral" class="level2">
<h2 class="anchored" data-anchor-id="buscando-el-umbral">Buscando el umbral</h2>
<p>Hasta ahora hemos evaluado el modelo de manera general, pero el resultado final del modelo debe consistir en asignar a la persona una clase predicha. En nuestro caso debemos establecer un punto de corte según el cual vamos a separar a los pacientes con ECV de los que no tienen ECV.</p>
<p>Probamos varios puntos de corte y graficamos el accuracy, la sensibilidad o recall, la especificidad y la precisión para cada uno de ellos.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Clases predichas / Clases</th>
<th>Negativa</th>
<th>Positiva</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Negativa</td>
<td>True Neg</td>
<td>False Neg</td>
</tr>
<tr class="even">
<td>Positiva</td>
<td>False Pos</td>
<td>True Pos</td>
</tr>
</tbody>
</table>
<p>Recordemos que:</p>
<p><span class="math inline">\(accuracy = \frac{TP+TN}{TP+FP+FN+TN}\)</span></p>
<p><span class="math inline">\(sensitivity = recall = \frac{TP}{TP+FN}\)</span></p>
<p><span class="math inline">\(specificity = \frac{TN}{TN+FP}\)</span></p>
<p><span class="math inline">\(precision = \frac{TP}{TP+FP}\)</span></p>
</section>
<section id="evaluando-en-test" class="level2">
<h2 class="anchored" data-anchor-id="evaluando-en-test">Evaluando en test</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Supongamos que 'mejor_modelo'</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> test,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                  cardio <span class="sc">~</span> weight <span class="sc">+</span> gender<span class="sc">+</span> cholesterol, </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># generamos las predicciones para el mejor modelo</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>test_model <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">.fitted =</span> <span class="fu">predict</span>(best_model, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cardio =</span> test<span class="sc">$</span>cardio</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># generamos una funcion que evalua diferentes umbrales y calcula las metricas</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>prediction_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(cutoff, predictions) {</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> predictions <span class="sc">%&gt;%</span> </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predicted_class =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(.fitted <span class="sc">&gt;</span> cutoff, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">cardio =</span> <span class="fu">factor</span>(cardio, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(tab<span class="sc">$</span>predicted_class, tab<span class="sc">$</span>cardio, <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(cm) <span class="sc">%&gt;%</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(term, estimate) <span class="sc">%&gt;%</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'accuracy'</span>,<span class="st">'sensitivity'</span>,<span class="st">'specificity'</span>,<span class="st">'precision'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cutoff =</span> cutoff)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># se calculan las metricas para diferentes valores de umbrales</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>cutoffs <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>metricas_df <span class="ot">&lt;-</span> <span class="fu">map_df</span>(cutoffs, <span class="sc">~</span> <span class="fu">prediction_metrics</span>(.x, <span class="at">predictions =</span> test_model)) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">as.factor</span>(term), <span class="at">estimate =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#graficamos los resultados</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(metricas_df, <span class="fu">aes</span>(<span class="at">x =</span> cutoff, <span class="at">y =</span> estimate, <span class="at">color =</span> term, <span class="at">group =</span> term)) <span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Accuracy, Sensitivity, Specificity y Precision vs Cutoff"</span>,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Punto de corte"</span>,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Valor de la métrica"</span>,</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Métrica"</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regLogistica_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>¿Cuál seria el umbral adecuado?</p>
<p>Punto de cruce entre sensitivity y specificity dado que se minimizan tanto FP y FN. Útil cuando no hay una clara preferencia por minimizar FP o FN.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>sel_cutoff <span class="ot">=</span> <span class="fl">0.45</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># calculamos las predicciones sobre el dataset de train</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>table_train <span class="ot">=</span> <span class="fu">augment</span>(<span class="at">x =</span> best_model, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">newdata =</span> train,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type.predict=</span><span class="st">'response'</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Clasificamos utilizamos el punto de corte</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>table_train <span class="ot">=</span> table_train <span class="sc">%&gt;%</span> </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted_class =</span> <span class="fu">if_else</span>(.fitted<span class="sc">&gt;</span>sel_cutoff, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>(), </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">cardio =</span> <span class="fu">factor</span>(cardio))</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos la matriz de confusión</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">table</span>(table_train<span class="sc">$</span>predicted_class, table_train<span class="sc">$</span>cardio), <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

   
      0   1
  0 261 151
  1 147 241
                                         
               Accuracy : 0.6275         
                 95% CI : (0.593, 0.6611)
    No Information Rate : 0.51           
    P-Value [Acc &gt; NIR] : 1.434e-11      
                                         
                  Kappa : 0.2546         
                                         
 Mcnemar's Test P-Value : 0.862          
                                         
            Sensitivity : 0.6148         
            Specificity : 0.6397         
         Pos Pred Value : 0.6211         
         Neg Pred Value : 0.6335         
             Prevalence : 0.4900         
         Detection Rate : 0.3013         
   Detection Prevalence : 0.4850         
      Balanced Accuracy : 0.6273         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos la predicciones al dataset de testeo</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>table_test <span class="ot">=</span> <span class="fu">augment</span>(<span class="at">x =</span> best_model, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">newdata=</span>test, </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type.predict=</span><span class="st">'response'</span>) </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Clasificamos utilizando el punto de corte</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>table_test <span class="ot">=</span> table_test <span class="sc">%&gt;%</span> </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted_class =</span> <span class="fu">if_else</span>(.fitted<span class="sc">&gt;</span>sel_cutoff, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos la matriz de confusión</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">table</span>(table_test<span class="sc">$</span>predicted_class, table_test<span class="sc">$</span>cardio), <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

   
     0  1
  0 69 29
  1 35 67
                                         
               Accuracy : 0.68           
                 95% CI : (0.6105, 0.744)
    No Information Rate : 0.52           
    P-Value [Acc &gt; NIR] : 3.184e-06      
                                         
                  Kappa : 0.3605         
                                         
 Mcnemar's Test P-Value : 0.532          
                                         
            Sensitivity : 0.6979         
            Specificity : 0.6635         
         Pos Pred Value : 0.6569         
         Neg Pred Value : 0.7041         
             Prevalence : 0.4800         
         Detection Rate : 0.3350         
   Detection Prevalence : 0.5100         
      Balanced Accuracy : 0.6807         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
<p>El 69.8 % de los casos positivos reales fueron correctamente identificados. (Probabilidad de detectar correctamente una ECV si la persona realmente la tiene.)</p>
<p>El 66.4 % de los casos negativos fueron correctamente identificados como tales.</p>
<p>De todos los que el modelo predijo como negativos, el 70.4 % realmente no tienen ECV.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>best_model</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = cardio ~ weight + gender + cholesterol, family = "binomial", 
    data = test)

Coefficients:
 (Intercept)        weight       gender2  cholesterol2  cholesterol3  
    -3.38811       0.04432      -0.51426       0.53028       1.27021  

Degrees of Freedom: 199 Total (i.e. Null);  195 Residual
Null Deviance:      276.9 
Residual Deviance: 249.3    AIC: 259.3</code></pre>
</div>
</div>
<section id="gráfico-de-hosmer-lemeshow" class="level3">
<h3 class="anchored" data-anchor-id="gráfico-de-hosmer-lemeshow">Gráfico de Hosmer Lemeshow</h3>
<p>Los gráficos de residuos vs predichos no son informativos para evaluar el ajuste del modelo, ya que la variable solo toma dos valores.</p>
<ul>
<li><p>En el eje X se observa la probabilidad predicha de contrarer una ECV.</p></li>
<li><p>En el eje Y se observa la frecuencia de clase, el cociente entre cantidad de individuos con ECV y el total de pacientes.</p></li>
<li><p>La línea punteada designa la igualdad entre probabilidad predicha y frecuencia de clase.</p></li>
<li><p>Los círculos, que se construyen de la siguiente manera:</p>
<ul>
<li>Se dividen a las observaciones en bins en base a la probabilidad predicha</li>
<li>Se calcula la frecuencia de clase para cada bin</li>
<li>En base a estas dos coordenadas se ubica al círculo en el gráfico</li>
<li>El número y tamaño indican la cantidad de observaciones en dicho grupo</li>
</ul></li>
</ul>
<p>Aquellos <strong>círculos que se ubiquen por encima</strong> de la línea punteada indican que el <strong>modelo está subestimando</strong> la probabilidad para dichos grupos. Mientras que si los <strong>círculos se ubican por debajo</strong> el modelo está <strong>sobreestimando</strong> la probabilidad para dichos grupos.</p>
<p>¿Para qué valores parece existir una sobreestimación de la probabilidad? ¿Para cuáles subestimación?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Hosmer_Lemeshow_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, predicted_column, class_column, bins, positive_value, <span class="at">color=</span><span class="st">'forestgreen'</span>, <span class="at">nudge_x=</span><span class="dv">0</span>, <span class="at">nudge_y=</span><span class="fl">0.05</span>){</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asignar los grupos a las observaciones de acuerdo a la probabilidad predicha</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  dataset[<span class="st">'group'</span>] <span class="ot">&lt;-</span> <span class="fu">bin</span>(dataset[predicted_column], <span class="at">nbins =</span> bins, <span class="at">method =</span> <span class="st">'l'</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>bins))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Contar la cantidad de casos positivos por grupo</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  positive_class <span class="ot">&lt;-</span> dataset <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(class_column)<span class="sc">==</span>positive_value) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtener la media de las predicciones por grupo</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  HL_df <span class="ot">&lt;-</span> dataset <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">pred=</span><span class="fu">mean</span>(<span class="sc">!!</span><span class="fu">sym</span>(predicted_column)), <span class="at">count=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">inner_join</span>(.,positive_class) <span class="sc">%&gt;%</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">freq=</span>n<span class="sc">/</span>count)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gráfico </span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  HM_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(HL_df, <span class="fu">aes</span>(<span class="at">x=</span>pred, <span class="at">y=</span>freq)) <span class="sc">+</span> </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>n), <span class="at">color=</span>color) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>n),<span class="at">nudge_y =</span> nudge_y)<span class="sc">+</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="st">'dashed'</span>) <span class="sc">+</span> </span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Hosmer-Lemeshow'</span>, <span class="at">size=</span><span class="st">'Casos'</span>, <span class="at">x=</span><span class="st">"Probabilidad Predicha"</span>, <span class="at">y=</span><span class="st">"Frecuencia observada"</span>)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(HM_plot)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo completo</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Hosmer_Lemeshow_plot</span>(test_model, <span class="st">'.fitted'</span>, <span class="st">'cardio'</span>, <span class="dv">10</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle=</span><span class="st">"Modelo final"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regLogistica_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>La prueba de Hosmer Lemeshow permite evaluar el buen ajuste del modelo</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ResourceSelection)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">hoslem.test</span> (test<span class="sc">$</span>cardio , </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">fitted</span>(best_model), <span class="at">g=</span><span class="dv">8</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>h1</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Hosmer and Lemeshow goodness of fit (GOF) test

data:  test$cardio, fitted(best_model)
X-squared = 2.0033, df = 6, p-value = 0.9194</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una secuencia de valores para 'weight' y combinar con los niveles de 'cholesterol'</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">seq</span>(<span class="fu">min</span>(train<span class="sc">$</span>weight), <span class="fu">max</span>(train<span class="sc">$</span>weight), <span class="at">length.out =</span> <span class="dv">150</span>),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cholesterol =</span> <span class="st">"1"</span>,  <span class="co"># fijamos un valor para el género</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">levels</span>(train<span class="sc">$</span>gender)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener probabilidades predichas del modelo</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>new_data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, <span class="at">newdata =</span> new_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar la función sigmoidea</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_data, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> predicted, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Peso"</span>,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probabilidad predicha de ECV"</span>,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Predicciones según género"</span>,</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Género"</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regLogistica_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!-- -->

</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Ejecutar el código</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb50" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Regresión Logística"</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Pamela Eugenia Pairo"</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="an">lang:</span><span class="co"> es</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: flatly</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(warning = FALSE, message = FALSE)</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="in"># Cargamos las librerías que vamos a utilizar</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidymodels)</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="in">library(modelr)</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="in">library(GGally)</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="in">library(pROC)</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="in">library(cowplot)</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="in">library(OneR)</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="in">library(rlang)</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="in">library(caret)</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(15)</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="fu"># Presentación del caso de estudio</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>Vamos a trabajar con una base de datos extraída de <span class="co">[</span><span class="ot">Kaggle</span><span class="co">](https://www.kaggle.com/code/robinreni/cardiovascular-disease-eda-detailed/notebook)</span>. Es una base de datos que consiste de 69301 registros de pacientes a los que se les registró 12 caracteristicas asociadas a una enfermedad cardiovascular.</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>El objetivo de esta clase es utilizar diferentes modelos de regresión logística para predecir la presencia o ausencia de enfermedad cardiovascular (ECV) utilizando los resultados del examen del paciente.</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>**Descripción de los datos**</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Age: edad del paciente (días)</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Height: altura del paciente (cm)</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Weight: peso del paciente (kg)</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Gender: sexo biológio del paciente (1: mujer, 2:varón)</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Systolic blood pressure: Presión arterial sistólica</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Diastolic blood pressure: Presión arterial diastólica</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Cholesterol: colesterol en sangre del paciente (1: normal, 2: por encima de lo normal, 3: muy por encima de lo normal)</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Glucose: glucosa (1: normal, 2: por encima de lo normal, 3: muy por encima de lo normal)</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Smoking: fuma/no fuma</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Alcohol intake: consume alcohol/ no consume alcohol</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Physical activity; realiza actividad física/ no realiza actividad física</span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Cardiovascular disease: variable target (0:no, 1:si)</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"cardio_train.csv"</span>, <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(df))<span class="co"># chequeamos si hay datos faltantes</span></span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">duplicated</span>(df))<span class="co">#chequeamos duplicados</span></span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a><span class="fu"># Creación de base de datos</span></span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a>Se genera una muestra de tamaño 1000 con la que se realizaran los análisis y se analiza si hay desbalance en la variable respuesta.</span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-79"><a href="#cb50-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-80"><a href="#cb50-80" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sample_n</span>(<span class="dv">1000</span>)</span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cardio) <span class="sc">%&gt;%</span></span>
<span id="cb50-85"><a href="#cb50-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cnt =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb50-86"><a href="#cb50-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq =</span> <span class="fu">round</span>(cnt <span class="sc">/</span> <span class="fu">sum</span>(cnt), <span class="dv">2</span>))</span>
<span id="cb50-87"><a href="#cb50-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-88"><a href="#cb50-88" aria-hidden="true" tabindex="-1"></a><span class="fu">## Partición de la base de datos</span></span>
<span id="cb50-89"><a href="#cb50-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-92"><a href="#cb50-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-93"><a href="#cb50-93" aria-hidden="true" tabindex="-1"></a>df_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(df,</span>
<span id="cb50-94"><a href="#cb50-94" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb50-95"><a href="#cb50-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-96"><a href="#cb50-96" aria-hidden="true" tabindex="-1"></a>train<span class="ot">&lt;-</span> df_split <span class="sc">%&gt;%</span></span>
<span id="cb50-97"><a href="#cb50-97" aria-hidden="true" tabindex="-1"></a>              <span class="fu">training</span>()</span>
<span id="cb50-98"><a href="#cb50-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-99"><a href="#cb50-99" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> df_split <span class="sc">%&gt;%</span></span>
<span id="cb50-100"><a href="#cb50-100" aria-hidden="true" tabindex="-1"></a>              <span class="fu">testing</span>()</span>
<span id="cb50-101"><a href="#cb50-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-102"><a href="#cb50-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de datos en train</span></span>
<span id="cb50-103"><a href="#cb50-103" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Total del dataset de entrenamiento: "</span>, <span class="fu">nrow</span>(train))</span>
<span id="cb50-104"><a href="#cb50-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-105"><a href="#cb50-105" aria-hidden="true" tabindex="-1"></a>Analizamos cómo quedo el balance de clases para <span class="in">`cardio`</span> en cada dataset.</span>
<span id="cb50-106"><a href="#cb50-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-109"><a href="#cb50-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-110"><a href="#cb50-110" aria-hidden="true" tabindex="-1"></a><span class="co"># calculamos la distribución de clase en cada dataset</span></span>
<span id="cb50-111"><a href="#cb50-111" aria-hidden="true" tabindex="-1"></a>train_ <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb50-112"><a href="#cb50-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cardio) <span class="sc">%&gt;%</span> </span>
<span id="cb50-113"><a href="#cb50-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">numero_casos=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb50-114"><a href="#cb50-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(numero_casos)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>))</span>
<span id="cb50-115"><a href="#cb50-115" aria-hidden="true" tabindex="-1"></a>test_ <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> </span>
<span id="cb50-116"><a href="#cb50-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cardio) <span class="sc">%&gt;%</span> </span>
<span id="cb50-117"><a href="#cb50-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">numero_casos=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb50-118"><a href="#cb50-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">round</span>(<span class="fu">prop.table</span>(numero_casos)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>))</span>
<span id="cb50-119"><a href="#cb50-119" aria-hidden="true" tabindex="-1"></a><span class="co"># armamos tabla conjunta para graficar</span></span>
<span id="cb50-120"><a href="#cb50-120" aria-hidden="true" tabindex="-1"></a>distrib <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">rbind</span>(train_, test_), <span class="at">dataset =</span> <span class="fu">c</span>(<span class="st">"train"</span>, <span class="st">"train"</span>, <span class="st">"test"</span>, <span class="st">"test"</span>))</span>
<span id="cb50-121"><a href="#cb50-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-122"><a href="#cb50-122" aria-hidden="true" tabindex="-1"></a><span class="co"># graficamos las distribuciones</span></span>
<span id="cb50-123"><a href="#cb50-123" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(distrib, <span class="fu">aes</span>(<span class="at">x =</span> cardio, <span class="at">y =</span> prop, <span class="at">fill =</span> <span class="fu">factor</span>(cardio), <span class="at">label =</span> prop)) <span class="sc">+</span> </span>
<span id="cb50-124"><a href="#cb50-124" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> dataset) <span class="sc">+</span></span>
<span id="cb50-125"><a href="#cb50-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb50-126"><a href="#cb50-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Proporción en %"</span>, <span class="at">title =</span> <span class="st">"Proporción de cardio por dataset"</span>) <span class="sc">+</span> </span>
<span id="cb50-127"><a href="#cb50-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill=</span><span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">"cardio"</span>))<span class="sc">+</span></span>
<span id="cb50-128"><a href="#cb50-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb50-129"><a href="#cb50-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">"Set2"</span>)</span>
<span id="cb50-130"><a href="#cb50-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-131"><a href="#cb50-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-134"><a href="#cb50-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-135"><a href="#cb50-135" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(train)</span>
<span id="cb50-136"><a href="#cb50-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-137"><a href="#cb50-137" aria-hidden="true" tabindex="-1"></a>Seleccioamos las variables con las que vamos a trabajar y les asignamos el tipo de dato correspondiente.</span>
<span id="cb50-138"><a href="#cb50-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-141"><a href="#cb50-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-142"><a href="#cb50-142" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, </span>
<span id="cb50-143"><a href="#cb50-143" aria-hidden="true" tabindex="-1"></a>          <span class="st">"height"</span>, </span>
<span id="cb50-144"><a href="#cb50-144" aria-hidden="true" tabindex="-1"></a>          <span class="st">"weight"</span>, </span>
<span id="cb50-145"><a href="#cb50-145" aria-hidden="true" tabindex="-1"></a>          <span class="st">"gender"</span>, </span>
<span id="cb50-146"><a href="#cb50-146" aria-hidden="true" tabindex="-1"></a>          <span class="st">"cholesterol"</span>,</span>
<span id="cb50-147"><a href="#cb50-147" aria-hidden="true" tabindex="-1"></a>          <span class="st">"gluc"</span>,</span>
<span id="cb50-148"><a href="#cb50-148" aria-hidden="true" tabindex="-1"></a>          <span class="st">"cardio"</span>)</span>
<span id="cb50-149"><a href="#cb50-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-150"><a href="#cb50-150" aria-hidden="true" tabindex="-1"></a>train<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train<span class="sc">$</span>gender)</span>
<span id="cb50-151"><a href="#cb50-151" aria-hidden="true" tabindex="-1"></a>train<span class="sc">$</span>cholesterol <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train<span class="sc">$</span>cholesterol)</span>
<span id="cb50-152"><a href="#cb50-152" aria-hidden="true" tabindex="-1"></a>train<span class="sc">$</span>gluc <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train<span class="sc">$</span>gluc)</span>
<span id="cb50-153"><a href="#cb50-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-154"><a href="#cb50-154" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test<span class="sc">$</span>gender)</span>
<span id="cb50-155"><a href="#cb50-155" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>cholesterol <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test<span class="sc">$</span>cholesterol)</span>
<span id="cb50-156"><a href="#cb50-156" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>gluc <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test<span class="sc">$</span>gluc)</span>
<span id="cb50-157"><a href="#cb50-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-158"><a href="#cb50-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-159"><a href="#cb50-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-162"><a href="#cb50-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-163"><a href="#cb50-163" aria-hidden="true" tabindex="-1"></a><span class="co"># graficamos con ggpairs coloreando por variable a predecir</span></span>
<span id="cb50-164"><a href="#cb50-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-165"><a href="#cb50-165" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb50-166"><a href="#cb50-166" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cardio =</span> <span class="fu">factor</span>(cardio)) <span class="sc">%&gt;%</span></span>
<span id="cb50-167"><a href="#cb50-167" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="fu">all_of</span>(cols)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-168"><a href="#cb50-168" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggpairs</span>(<span class="at">title =</span> <span class="st">"Correlograma de variables"</span>,</span>
<span id="cb50-169"><a href="#cb50-169" aria-hidden="true" tabindex="-1"></a>                <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">colour=</span> cardio),</span>
<span id="cb50-170"><a href="#cb50-170" aria-hidden="true" tabindex="-1"></a>                <span class="at">progress =</span> <span class="cn">FALSE</span>, </span>
<span id="cb50-171"><a href="#cb50-171" aria-hidden="true" tabindex="-1"></a>                <span class="at">lower=</span><span class="fu">list</span>(<span class="at">combo=</span><span class="fu">wrap</span>(<span class="st">"facethist"</span>, <span class="at">binwidth=</span><span class="fl">0.8</span>))) <span class="sc">+</span></span>
<span id="cb50-172"><a href="#cb50-172" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb50-173"><a href="#cb50-173" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb50-174"><a href="#cb50-174" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb50-175"><a href="#cb50-175" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_color_brewer</span>(<span class="at">palette=</span><span class="st">"Set2"</span>)</span>
<span id="cb50-176"><a href="#cb50-176" aria-hidden="true" tabindex="-1"></a>g</span>
<span id="cb50-177"><a href="#cb50-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-178"><a href="#cb50-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-179"><a href="#cb50-179" aria-hidden="true" tabindex="-1"></a><span class="fu"># Regresión lineal</span></span>
<span id="cb50-180"><a href="#cb50-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-181"><a href="#cb50-181" aria-hidden="true" tabindex="-1"></a>En este caso estamos modelando la probabilidad de la siguiente manera: </span>
<span id="cb50-182"><a href="#cb50-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-183"><a href="#cb50-183" aria-hidden="true" tabindex="-1"></a>$P(X)= \beta_0 + \sum\limits_{j=1}^p \beta_j X_j$</span>
<span id="cb50-184"><a href="#cb50-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-185"><a href="#cb50-185" aria-hidden="true" tabindex="-1"></a>Veamos que tan bueno es el modelo lineal para esto, usando el peso como predictor.</span>
<span id="cb50-186"><a href="#cb50-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-189"><a href="#cb50-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-190"><a href="#cb50-190" aria-hidden="true" tabindex="-1"></a>mrl <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb50-191"><a href="#cb50-191" aria-hidden="true" tabindex="-1"></a>              <span class="fu">lm</span>(<span class="at">formula =</span> cardio <span class="sc">~</span> weight) </span>
<span id="cb50-192"><a href="#cb50-192" aria-hidden="true" tabindex="-1"></a>tdy <span class="ot">=</span> mrl <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() </span>
<span id="cb50-193"><a href="#cb50-193" aria-hidden="true" tabindex="-1"></a>tdy</span>
<span id="cb50-194"><a href="#cb50-194" aria-hidden="true" tabindex="-1"></a>mrl <span class="sc">%&gt;%</span> <span class="fu">glance</span>()</span>
<span id="cb50-195"><a href="#cb50-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-196"><a href="#cb50-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-197"><a href="#cb50-197" aria-hidden="true" tabindex="-1"></a>Los estimadores son significativos y el test de significatividad global del modelo también es significativo.</span>
<span id="cb50-198"><a href="#cb50-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-199"><a href="#cb50-199" aria-hidden="true" tabindex="-1"></a>Veamos un gráfico de nuestro modelo.</span>
<span id="cb50-200"><a href="#cb50-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-201"><a href="#cb50-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb50-202"><a href="#cb50-202" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(train, aes(weight, cardio)) + </span></span>
<span id="cb50-203"><a href="#cb50-203" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(aes(color=factor(cardio))) +</span></span>
<span id="cb50-204"><a href="#cb50-204" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_brewer(palette = "Set2") + </span></span>
<span id="cb50-205"><a href="#cb50-205" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_abline(intercept = tdy$estimate[1], slope = tdy$estimate[2], color='forestgreen', size=2) + </span></span>
<span id="cb50-206"><a href="#cb50-206" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title="Modelo Lineal Simple", color='Clase') +</span></span>
<span id="cb50-207"><a href="#cb50-207" aria-hidden="true" tabindex="-1"></a><span class="in">  lims(y=c(-1,2))+</span></span>
<span id="cb50-208"><a href="#cb50-208" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw()</span></span>
<span id="cb50-209"><a href="#cb50-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-210"><a href="#cb50-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-211"><a href="#cb50-211" aria-hidden="true" tabindex="-1"></a>Parece tener bastantes problemas para estimar la probabilidad de supervivencia de los individuo: no existe un punto de corte claro, la predicción podría ser mayor a 1 o menor a cero llegado el caso.</span>
<span id="cb50-212"><a href="#cb50-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-213"><a href="#cb50-213" aria-hidden="true" tabindex="-1"></a><span class="fu"># Recap de Regresión Logística</span></span>
<span id="cb50-214"><a href="#cb50-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-215"><a href="#cb50-215" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Odds**</span></span>
<span id="cb50-216"><a href="#cb50-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-217"><a href="#cb50-217" aria-hidden="true" tabindex="-1"></a>Cociente entre la probabilidad de éxito de un evento y la probabilidad de que no ocurra.</span>
<span id="cb50-218"><a href="#cb50-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-219"><a href="#cb50-219" aria-hidden="true" tabindex="-1"></a>$Odds = \frac{P(x)}{1-P(x)}$</span>
<span id="cb50-220"><a href="#cb50-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-221"><a href="#cb50-221" aria-hidden="true" tabindex="-1"></a>Ej. si _Odds_ es 3 indica que por cada 4 repeticiones del evento se espera que ocurran 3 y que una no ocurra.</span>
<span id="cb50-222"><a href="#cb50-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-223"><a href="#cb50-223" aria-hidden="true" tabindex="-1"></a>Odds &lt; 1 : es mas probable que no ocurra a que si</span>
<span id="cb50-224"><a href="#cb50-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-225"><a href="#cb50-225" aria-hidden="true" tabindex="-1"></a>Odds = 1 : equiprobabilidad</span>
<span id="cb50-226"><a href="#cb50-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-227"><a href="#cb50-227" aria-hidden="true" tabindex="-1"></a>Odds &gt; 1: es mas probable que el evento ocurra a que no.</span>
<span id="cb50-228"><a href="#cb50-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-229"><a href="#cb50-229" aria-hidden="true" tabindex="-1"></a>En nuestro caso:</span>
<span id="cb50-230"><a href="#cb50-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-231"><a href="#cb50-231" aria-hidden="true" tabindex="-1"></a>$Odds = \frac{391/800}{409/800}= 0.9558 \approx \frac{191}{200}$</span>
<span id="cb50-232"><a href="#cb50-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-233"><a href="#cb50-233" aria-hidden="true" tabindex="-1"></a>Por cada 191 pacientes con ECV, 200 no la tienen.</span>
<span id="cb50-234"><a href="#cb50-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-235"><a href="#cb50-235" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Logit**</span></span>
<span id="cb50-236"><a href="#cb50-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-237"><a href="#cb50-237" aria-hidden="true" tabindex="-1"></a>$Logit = \log {\frac{P(x)}{1-P(x)}}= \log Odds$</span>
<span id="cb50-238"><a href="#cb50-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-239"><a href="#cb50-239" aria-hidden="true" tabindex="-1"></a><span class="fu">## **_Odds Ratio_ (OR)**</span></span>
<span id="cb50-240"><a href="#cb50-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-241"><a href="#cb50-241" aria-hidden="true" tabindex="-1"></a>Es una medida de magnitud de efecto. Si tenemos el siguiente modelo de regresión logística</span>
<span id="cb50-242"><a href="#cb50-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-243"><a href="#cb50-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-244"><a href="#cb50-244" aria-hidden="true" tabindex="-1"></a>$\log\left(\frac{p}{1 - p}\right) = \beta_0 + \beta_1 X$</span>
<span id="cb50-245"><a href="#cb50-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-246"><a href="#cb50-246" aria-hidden="true" tabindex="-1"></a>El odds ratio asociado a la variable $\ X$ es:</span>
<span id="cb50-247"><a href="#cb50-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-248"><a href="#cb50-248" aria-hidden="true" tabindex="-1"></a>$\text{OR} = e^{\beta_1}$</span>
<span id="cb50-249"><a href="#cb50-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-250"><a href="#cb50-250" aria-hidden="true" tabindex="-1"></a>OR = 1 No hay efecto</span>
<span id="cb50-251"><a href="#cb50-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-252"><a href="#cb50-252" aria-hidden="true" tabindex="-1"></a>OR &gt; 1 asociación positiva</span>
<span id="cb50-253"><a href="#cb50-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-254"><a href="#cb50-254" aria-hidden="true" tabindex="-1"></a>OR &lt; 1 asociación negativa</span>
<span id="cb50-255"><a href="#cb50-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-256"><a href="#cb50-256" aria-hidden="true" tabindex="-1"></a><span class="fu">## Escalas de análisis</span></span>
<span id="cb50-257"><a href="#cb50-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-258"><a href="#cb50-258" aria-hidden="true" tabindex="-1"></a>1- Predictor lineal</span>
<span id="cb50-259"><a href="#cb50-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-260"><a href="#cb50-260" aria-hidden="true" tabindex="-1"></a>2- Odds</span>
<span id="cb50-261"><a href="#cb50-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-262"><a href="#cb50-262" aria-hidden="true" tabindex="-1"></a>3- Variable respuesta</span>
<span id="cb50-263"><a href="#cb50-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-264"><a href="#cb50-264" aria-hidden="true" tabindex="-1"></a><span class="al">![Imagen adaptada de la clase de RL de Adriana Perez](rl.png)</span>{}</span>
<span id="cb50-265"><a href="#cb50-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-266"><a href="#cb50-266" aria-hidden="true" tabindex="-1"></a><span class="fu"># Regresión Logística</span></span>
<span id="cb50-267"><a href="#cb50-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-268"><a href="#cb50-268" aria-hidden="true" tabindex="-1"></a>Para evitar los problemas vistos con regresión lineal, usamos la **función logística**.</span>
<span id="cb50-269"><a href="#cb50-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-270"><a href="#cb50-270" aria-hidden="true" tabindex="-1"></a>$P(Y=1|X)= \frac{e^{\beta_0 + \sum\limits_{j=1}^p \beta_j X_j}}{1+e^{\beta_0 + \sum\limits_{j=1}^p \beta_j X_j}}$</span>
<span id="cb50-271"><a href="#cb50-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-272"><a href="#cb50-272" aria-hidden="true" tabindex="-1"></a>Esta función acota el resultado entre 0 y 1, lo cual es mucho más adecuado para modelar una probabilidad.</span>
<span id="cb50-273"><a href="#cb50-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-274"><a href="#cb50-274" aria-hidden="true" tabindex="-1"></a>Luego de hacer algunas operaciones, podemos llegar a la expresión:</span>
<span id="cb50-275"><a href="#cb50-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-276"><a href="#cb50-276" aria-hidden="true" tabindex="-1"></a>$\log {\frac{P(x)}{1-P(x)}}= \beta_0 + \sum\limits_{j=1}^p \beta_j X_j$</span>
<span id="cb50-277"><a href="#cb50-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-278"><a href="#cb50-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-279"><a href="#cb50-279" aria-hidden="true" tabindex="-1"></a>La funcíón <span class="in">`glm()`</span> nos permite crear un modelo lineal generalizado (Generalized Linear Model). Al igual que la función <span class="in">`lm()`</span> toma como argumentos una **formula** y los **datos** pero también se debe especificar el argumento **family**: indicamos la distribución del error y la función link que vamos a utilizar en el modelo. </span>
<span id="cb50-280"><a href="#cb50-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-281"><a href="#cb50-281" aria-hidden="true" tabindex="-1"></a>Algunas familias son:</span>
<span id="cb50-282"><a href="#cb50-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-283"><a href="#cb50-283" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>*Binomial*: link=logit</span>
<span id="cb50-284"><a href="#cb50-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-285"><a href="#cb50-285" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>*Poisson*: link=log</span>
<span id="cb50-286"><a href="#cb50-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-287"><a href="#cb50-287" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>*Gaussiana*: link=identidad</span>
<span id="cb50-288"><a href="#cb50-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-289"><a href="#cb50-289" aria-hidden="true" tabindex="-1"></a>Como estamos trabajando con un fenómeno que suponemos tiene una distribución binomial, así lo especificamos en el parámetro **family**.</span>
<span id="cb50-290"><a href="#cb50-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-291"><a href="#cb50-291" aria-hidden="true" tabindex="-1"></a>Realizamos un modelo de regresión logística para predecir la si el paciente tiene una ECV en función de **weight** y **gender**. </span>
<span id="cb50-292"><a href="#cb50-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-293"><a href="#cb50-293" aria-hidden="true" tabindex="-1"></a>$\log {\frac{P(x)}{1-P(x)}}= \beta_0 + \beta_1 weight + \beta_2 age + \beta_2 varón$</span>
<span id="cb50-294"><a href="#cb50-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-295"><a href="#cb50-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-296"><a href="#cb50-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-299"><a href="#cb50-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-300"><a href="#cb50-300" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo de regresión logística </span></span>
<span id="cb50-301"><a href="#cb50-301" aria-hidden="true" tabindex="-1"></a>glm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> train,</span>
<span id="cb50-302"><a href="#cb50-302" aria-hidden="true" tabindex="-1"></a>            cardio <span class="sc">~</span> weight <span class="sc">+</span> gender, </span>
<span id="cb50-303"><a href="#cb50-303" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb50-304"><a href="#cb50-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-305"><a href="#cb50-305" aria-hidden="true" tabindex="-1"></a><span class="co"># veo los resultados</span></span>
<span id="cb50-306"><a href="#cb50-306" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(glm1)</span>
<span id="cb50-307"><a href="#cb50-307" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(glm1)</span>
<span id="cb50-308"><a href="#cb50-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-309"><a href="#cb50-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-310"><a href="#cb50-310" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpretación de los coeficientes del modelo</span></span>
<span id="cb50-311"><a href="#cb50-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-312"><a href="#cb50-312" aria-hidden="true" tabindex="-1"></a>Modelo estimado</span>
<span id="cb50-313"><a href="#cb50-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-314"><a href="#cb50-314" aria-hidden="true" tabindex="-1"></a>$\log {\frac{P(x)}{1-P(x)}}= -2.71 + 0.03* weight - 0.2*varón$</span>
<span id="cb50-315"><a href="#cb50-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-316"><a href="#cb50-316" aria-hidden="true" tabindex="-1"></a>**Peso**</span>
<span id="cb50-317"><a href="#cb50-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-318"><a href="#cb50-318" aria-hidden="true" tabindex="-1"></a>Se espera un aumento de 0.03 unidades en el log de odds por cada aumento de 1kgr en el peso (manteniendo el resto de las variables constantes). La probabilidad de contraer una ECV aumenta con el aumento de peso del paciente.</span>
<span id="cb50-319"><a href="#cb50-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-320"><a href="#cb50-320" aria-hidden="true" tabindex="-1"></a>$\ OR = e^{\beta_{weight}}= e^{0.03}= 1.03$</span>
<span id="cb50-321"><a href="#cb50-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-322"><a href="#cb50-322" aria-hidden="true" tabindex="-1"></a>Por cada aumento de 1 kgr se estima que el odds de contraer una ECV aumente 3.05%</span>
<span id="cb50-323"><a href="#cb50-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-324"><a href="#cb50-324" aria-hidden="true" tabindex="-1"></a>**Género**</span>
<span id="cb50-325"><a href="#cb50-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-326"><a href="#cb50-326" aria-hidden="true" tabindex="-1"></a>$\ Odds_{varón} = {\frac{Prob_{ECV} /varón}{Prob_{noECV}/varón}}$</span>
<span id="cb50-327"><a href="#cb50-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-328"><a href="#cb50-328" aria-hidden="true" tabindex="-1"></a>$\ Odds_{mujer} = {\frac{Prob_{ECV} /mujer}{Prob_{noECV}/mujer}}$</span>
<span id="cb50-329"><a href="#cb50-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-330"><a href="#cb50-330" aria-hidden="true" tabindex="-1"></a>$\ OR = {\frac{Odds_{varón}}{Odds_{mujer}}}= e^{\beta_{género}}= e^{-0.02}$</span>
<span id="cb50-331"><a href="#cb50-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-332"><a href="#cb50-332" aria-hidden="true" tabindex="-1"></a>El odds ratio para la variable género es 0.98, lo que indica que los varones tienen un 2 % menos de odds de presentar una ECV que las mujeres, manteniendo constante el peso. En consecuencia, ser mujer se asocia con un riesgo mayor riesgo relativo de ECV.</span>
<span id="cb50-333"><a href="#cb50-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-334"><a href="#cb50-334" aria-hidden="true" tabindex="-1"></a><span class="fu">### Devianza</span></span>
<span id="cb50-335"><a href="#cb50-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-336"><a href="#cb50-336" aria-hidden="true" tabindex="-1"></a>Es una medida de la falta de ajuste del modelo. Cuanto menor es la devianza residual, mejor se ajusta el modelo.</span>
<span id="cb50-337"><a href="#cb50-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-338"><a href="#cb50-338" aria-hidden="true" tabindex="-1"></a>$\ Devianza Explicada = {\frac{Dev_{mod null} - Dev_{Mod}}{Dev_{mod null}}}$</span>
<span id="cb50-339"><a href="#cb50-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-340"><a href="#cb50-340" aria-hidden="true" tabindex="-1"></a>$\ Devianza Explicada = {\frac{1108.71 - 1056.63}{1108.71}}= 0.046$</span>
<span id="cb50-341"><a href="#cb50-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-344"><a href="#cb50-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-345"><a href="#cb50-345" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> (glm1<span class="sc">$</span>deviance <span class="sc">/</span> glm1<span class="sc">$</span>null.deviance)</span>
<span id="cb50-346"><a href="#cb50-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-347"><a href="#cb50-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-348"><a href="#cb50-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-349"><a href="#cb50-349" aria-hidden="true" tabindex="-1"></a><span class="fu"># Selección de modelos</span></span>
<span id="cb50-350"><a href="#cb50-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-351"><a href="#cb50-351" aria-hidden="true" tabindex="-1"></a>Se generan la combinación de todos los modelos posibles a partir de las variables <span class="in">`gender`</span>, <span class="in">`weight`</span>, y <span class="in">`cholesterol`</span>. Antes hacemos un boxplot con <span class="in">`weight`</span>, <span class="in">`cholesterol`</span> y <span class="in">`cardio`</span>.</span>
<span id="cb50-352"><a href="#cb50-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-355"><a href="#cb50-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-356"><a href="#cb50-356" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">x =</span> cholesterol, <span class="at">y =</span> weight, <span class="at">fill =</span> <span class="fu">factor</span>(cardio))) <span class="sc">+</span></span>
<span id="cb50-357"><a href="#cb50-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb50-358"><a href="#cb50-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"cholesterol"</span>, <span class="at">y =</span> <span class="st">"Peso"</span>, <span class="at">fill =</span> <span class="st">"cardio"</span>) <span class="sc">+</span></span>
<span id="cb50-359"><a href="#cb50-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb50-360"><a href="#cb50-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">"Set2"</span>)</span>
<span id="cb50-361"><a href="#cb50-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-362"><a href="#cb50-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-365"><a href="#cb50-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-366"><a href="#cb50-366" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gender"</span>, </span>
<span id="cb50-367"><a href="#cb50-367" aria-hidden="true" tabindex="-1"></a>          <span class="st">"weight"</span>, </span>
<span id="cb50-368"><a href="#cb50-368" aria-hidden="true" tabindex="-1"></a>          <span class="st">"cholesterol"</span>)</span>
<span id="cb50-369"><a href="#cb50-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-370"><a href="#cb50-370" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear todas las combinaciones posibles de predictores</span></span>
<span id="cb50-371"><a href="#cb50-371" aria-hidden="true" tabindex="-1"></a>combs <span class="ot">&lt;-</span> <span class="fu">unlist</span>(</span>
<span id="cb50-372"><a href="#cb50-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(vars), <span class="cf">function</span>(i) <span class="fu">combn</span>(vars, i, <span class="at">simplify =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb50-373"><a href="#cb50-373" aria-hidden="true" tabindex="-1"></a>  <span class="at">recursive =</span> <span class="cn">FALSE</span></span>
<span id="cb50-374"><a href="#cb50-374" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-375"><a href="#cb50-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-376"><a href="#cb50-376" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una lista de fórmulas</span></span>
<span id="cb50-377"><a href="#cb50-377" aria-hidden="true" tabindex="-1"></a>formulas <span class="ot">&lt;-</span> <span class="fu">map</span>(combs, <span class="sc">~</span> <span class="fu">reformulate</span>(<span class="at">termlabels =</span> .x, <span class="at">response =</span> <span class="st">"cardio"</span>))</span>
<span id="cb50-378"><a href="#cb50-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-379"><a href="#cb50-379" aria-hidden="true" tabindex="-1"></a>formulas</span>
<span id="cb50-380"><a href="#cb50-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-381"><a href="#cb50-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-382"><a href="#cb50-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-385"><a href="#cb50-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-386"><a href="#cb50-386" aria-hidden="true" tabindex="-1"></a><span class="co">#se realizan las regresiones logisticas para todos los modelos</span></span>
<span id="cb50-387"><a href="#cb50-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-388"><a href="#cb50-388" aria-hidden="true" tabindex="-1"></a>modelos <span class="ot">&lt;-</span> <span class="fu">map</span>(formulas, <span class="sc">~</span> <span class="fu">glm</span>(.x, <span class="at">data =</span> train, <span class="at">family =</span> binomial))</span>
<span id="cb50-389"><a href="#cb50-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-390"><a href="#cb50-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-391"><a href="#cb50-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-392"><a href="#cb50-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-393"><a href="#cb50-393" aria-hidden="true" tabindex="-1"></a><span class="fu">## Evaluando los modelos en train</span></span>
<span id="cb50-394"><a href="#cb50-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-395"><a href="#cb50-395" aria-hidden="true" tabindex="-1"></a>Analizamos la performance de los modelos generados</span>
<span id="cb50-396"><a href="#cb50-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-399"><a href="#cb50-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-400"><a href="#cb50-400" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb50-401"><a href="#cb50-401" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">map_chr</span>(formulas, format),</span>
<span id="cb50-402"><a href="#cb50-402" aria-hidden="true" tabindex="-1"></a>  <span class="at">deviance =</span> <span class="fu">map_dbl</span>(modelos, <span class="sc">~</span> .<span class="sc">$</span>deviance),</span>
<span id="cb50-403"><a href="#cb50-403" aria-hidden="true" tabindex="-1"></a>  <span class="at">null_deviance =</span> <span class="fu">map_dbl</span>(modelos, <span class="sc">~</span> .<span class="sc">$</span>null.deviance),</span>
<span id="cb50-404"><a href="#cb50-404" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">map_dbl</span>(modelos, AIC)</span>
<span id="cb50-405"><a href="#cb50-405" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb50-406"><a href="#cb50-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dev_explicada =</span> <span class="dv">1</span> <span class="sc">-</span> deviance <span class="sc">/</span> null_deviance)<span class="sc">%&gt;%</span></span>
<span id="cb50-407"><a href="#cb50-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dev_explicada))<span class="co"># se ordena segñun devianza explicada</span></span>
<span id="cb50-408"><a href="#cb50-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-409"><a href="#cb50-409" aria-hidden="true" tabindex="-1"></a>resultados</span>
<span id="cb50-410"><a href="#cb50-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-411"><a href="#cb50-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-412"><a href="#cb50-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-413"><a href="#cb50-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-416"><a href="#cb50-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-417"><a href="#cb50-417" aria-hidden="true" tabindex="-1"></a>prediction_full <span class="ot">&lt;-</span> <span class="fu">map2</span>(modelos, formulas, <span class="sc">~</span> {</span>
<span id="cb50-418"><a href="#cb50-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb50-419"><a href="#cb50-419" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fitted =</span> <span class="fu">predict</span>(.x, <span class="at">newdata =</span> train, <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb50-420"><a href="#cb50-420" aria-hidden="true" tabindex="-1"></a>    <span class="at">cardio =</span> train<span class="sc">$</span>cardio</span>
<span id="cb50-421"><a href="#cb50-421" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-422"><a href="#cb50-422" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb50-423"><a href="#cb50-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-424"><a href="#cb50-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-425"><a href="#cb50-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-428"><a href="#cb50-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-429"><a href="#cb50-429" aria-hidden="true" tabindex="-1"></a>roc_df <span class="ot">&lt;-</span> <span class="fu">map2_dfr</span>(modelos, resultados<span class="sc">$</span>formula, <span class="sc">~</span> {</span>
<span id="cb50-430"><a href="#cb50-430" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(train<span class="sc">$</span>cardio, <span class="fu">predict</span>(.x, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb50-431"><a href="#cb50-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb50-432"><a href="#cb50-432" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr =</span> roc_obj<span class="sc">$</span>sensitivities,</span>
<span id="cb50-433"><a href="#cb50-433" aria-hidden="true" tabindex="-1"></a>    <span class="at">fpr =</span> <span class="dv">1</span> <span class="sc">-</span> roc_obj<span class="sc">$</span>specificities,</span>
<span id="cb50-434"><a href="#cb50-434" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> .y</span>
<span id="cb50-435"><a href="#cb50-435" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-436"><a href="#cb50-436" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb50-437"><a href="#cb50-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-438"><a href="#cb50-438" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(roc_df, <span class="fu">aes</span>(<span class="at">x =</span> fpr, <span class="at">y =</span> tpr, <span class="at">color =</span> formula)) <span class="sc">+</span></span>
<span id="cb50-439"><a href="#cb50-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb50-440"><a href="#cb50-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb50-441"><a href="#cb50-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"1 - Especificidad"</span>, <span class="at">y =</span> <span class="st">"Sensibilidad"</span>, <span class="at">title =</span> <span class="st">"Curvas ROC de todos los modelos"</span>) <span class="sc">+</span></span>
<span id="cb50-442"><a href="#cb50-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb50-443"><a href="#cb50-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-446"><a href="#cb50-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-447"><a href="#cb50-447" aria-hidden="true" tabindex="-1"></a>auc_values <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(modelos, <span class="sc">~</span> <span class="fu">auc</span>(<span class="fu">roc</span>(train<span class="sc">$</span>cardio, <span class="fu">predict</span>(.x, <span class="at">type =</span> <span class="st">"response"</span>))))</span>
<span id="cb50-448"><a href="#cb50-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-449"><a href="#cb50-449" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> resultados <span class="sc">%&gt;%</span></span>
<span id="cb50-450"><a href="#cb50-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AUC =</span> auc_values)</span>
<span id="cb50-451"><a href="#cb50-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-452"><a href="#cb50-452" aria-hidden="true" tabindex="-1"></a>resultados</span>
<span id="cb50-453"><a href="#cb50-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-454"><a href="#cb50-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-455"><a href="#cb50-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-456"><a href="#cb50-456" aria-hidden="true" tabindex="-1"></a><span class="fu">## Buscando el umbral</span></span>
<span id="cb50-457"><a href="#cb50-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-458"><a href="#cb50-458" aria-hidden="true" tabindex="-1"></a>Hasta ahora hemos evaluado el modelo de manera general, pero el resultado final del modelo debe consistir en asignar a la persona una clase predicha. En nuestro caso debemos establecer un punto de corte según el cual vamos a separar a los pacientes con ECV de los que no tienen ECV.</span>
<span id="cb50-459"><a href="#cb50-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-460"><a href="#cb50-460" aria-hidden="true" tabindex="-1"></a>Probamos varios puntos de corte y graficamos el accuracy, la sensibilidad o recall, la especificidad y la precisión para cada uno de ellos.</span>
<span id="cb50-461"><a href="#cb50-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-462"><a href="#cb50-462" aria-hidden="true" tabindex="-1"></a>| Clases predichas / Clases | Negativa | Positiva |</span>
<span id="cb50-463"><a href="#cb50-463" aria-hidden="true" tabindex="-1"></a>|--------------------------|---------|----------|</span>
<span id="cb50-464"><a href="#cb50-464" aria-hidden="true" tabindex="-1"></a>| Negativa                 | True Neg | False Neg |</span>
<span id="cb50-465"><a href="#cb50-465" aria-hidden="true" tabindex="-1"></a>| Positiva                 | False Pos | True Pos |</span>
<span id="cb50-466"><a href="#cb50-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-467"><a href="#cb50-467" aria-hidden="true" tabindex="-1"></a>Recordemos que:</span>
<span id="cb50-468"><a href="#cb50-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-469"><a href="#cb50-469" aria-hidden="true" tabindex="-1"></a>$accuracy = \frac{TP+TN}{TP+FP+FN+TN}$</span>
<span id="cb50-470"><a href="#cb50-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-471"><a href="#cb50-471" aria-hidden="true" tabindex="-1"></a>$sensitivity = recall = \frac{TP}{TP+FN}$</span>
<span id="cb50-472"><a href="#cb50-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-473"><a href="#cb50-473" aria-hidden="true" tabindex="-1"></a>$specificity = \frac{TN}{TN+FP}$</span>
<span id="cb50-474"><a href="#cb50-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-475"><a href="#cb50-475" aria-hidden="true" tabindex="-1"></a>$precision = \frac{TP}{TP+FP}$</span>
<span id="cb50-476"><a href="#cb50-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-477"><a href="#cb50-477" aria-hidden="true" tabindex="-1"></a><span class="fu">## Evaluando en test</span></span>
<span id="cb50-478"><a href="#cb50-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-481"><a href="#cb50-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-482"><a href="#cb50-482" aria-hidden="true" tabindex="-1"></a><span class="co"># Supongamos que 'mejor_modelo'</span></span>
<span id="cb50-483"><a href="#cb50-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-484"><a href="#cb50-484" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> test,</span>
<span id="cb50-485"><a href="#cb50-485" aria-hidden="true" tabindex="-1"></a>                  cardio <span class="sc">~</span> weight <span class="sc">+</span> gender<span class="sc">+</span> cholesterol, </span>
<span id="cb50-486"><a href="#cb50-486" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb50-487"><a href="#cb50-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-488"><a href="#cb50-488" aria-hidden="true" tabindex="-1"></a><span class="co"># generamos las predicciones para el mejor modelo</span></span>
<span id="cb50-489"><a href="#cb50-489" aria-hidden="true" tabindex="-1"></a>test_model <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb50-490"><a href="#cb50-490" aria-hidden="true" tabindex="-1"></a>  <span class="at">.fitted =</span> <span class="fu">predict</span>(best_model, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb50-491"><a href="#cb50-491" aria-hidden="true" tabindex="-1"></a>  <span class="at">cardio =</span> test<span class="sc">$</span>cardio</span>
<span id="cb50-492"><a href="#cb50-492" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-493"><a href="#cb50-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-494"><a href="#cb50-494" aria-hidden="true" tabindex="-1"></a><span class="co"># generamos una funcion que evalua diferentes umbrales y calcula las metricas</span></span>
<span id="cb50-495"><a href="#cb50-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-496"><a href="#cb50-496" aria-hidden="true" tabindex="-1"></a>prediction_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(cutoff, predictions) {</span>
<span id="cb50-497"><a href="#cb50-497" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> predictions <span class="sc">%&gt;%</span> </span>
<span id="cb50-498"><a href="#cb50-498" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predicted_class =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(.fitted <span class="sc">&gt;</span> cutoff, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb50-499"><a href="#cb50-499" aria-hidden="true" tabindex="-1"></a>           <span class="at">cardio =</span> <span class="fu">factor</span>(cardio, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb50-500"><a href="#cb50-500" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-501"><a href="#cb50-501" aria-hidden="true" tabindex="-1"></a>  cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(tab<span class="sc">$</span>predicted_class, tab<span class="sc">$</span>cardio, <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb50-502"><a href="#cb50-502" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-503"><a href="#cb50-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(cm) <span class="sc">%&gt;%</span></span>
<span id="cb50-504"><a href="#cb50-504" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(term, estimate) <span class="sc">%&gt;%</span></span>
<span id="cb50-505"><a href="#cb50-505" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'accuracy'</span>,<span class="st">'sensitivity'</span>,<span class="st">'specificity'</span>,<span class="st">'precision'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb50-506"><a href="#cb50-506" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cutoff =</span> cutoff)</span>
<span id="cb50-507"><a href="#cb50-507" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-508"><a href="#cb50-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-509"><a href="#cb50-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-510"><a href="#cb50-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-511"><a href="#cb50-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-512"><a href="#cb50-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-515"><a href="#cb50-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-516"><a href="#cb50-516" aria-hidden="true" tabindex="-1"></a><span class="co"># se calculan las metricas para diferentes valores de umbrales</span></span>
<span id="cb50-517"><a href="#cb50-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-518"><a href="#cb50-518" aria-hidden="true" tabindex="-1"></a>cutoffs <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span>)</span>
<span id="cb50-519"><a href="#cb50-519" aria-hidden="true" tabindex="-1"></a>metricas_df <span class="ot">&lt;-</span> <span class="fu">map_df</span>(cutoffs, <span class="sc">~</span> <span class="fu">prediction_metrics</span>(.x, <span class="at">predictions =</span> test_model)) <span class="sc">%&gt;%</span></span>
<span id="cb50-520"><a href="#cb50-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">as.factor</span>(term), <span class="at">estimate =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>))</span>
<span id="cb50-521"><a href="#cb50-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-522"><a href="#cb50-522" aria-hidden="true" tabindex="-1"></a><span class="co">#graficamos los resultados</span></span>
<span id="cb50-523"><a href="#cb50-523" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(metricas_df, <span class="fu">aes</span>(<span class="at">x =</span> cutoff, <span class="at">y =</span> estimate, <span class="at">color =</span> term, <span class="at">group =</span> term)) <span class="sc">+</span></span>
<span id="cb50-524"><a href="#cb50-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb50-525"><a href="#cb50-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb50-526"><a href="#cb50-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb50-527"><a href="#cb50-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb50-528"><a href="#cb50-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb50-529"><a href="#cb50-529" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Accuracy, Sensitivity, Specificity y Precision vs Cutoff"</span>,</span>
<span id="cb50-530"><a href="#cb50-530" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Punto de corte"</span>,</span>
<span id="cb50-531"><a href="#cb50-531" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Valor de la métrica"</span>,</span>
<span id="cb50-532"><a href="#cb50-532" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Métrica"</span></span>
<span id="cb50-533"><a href="#cb50-533" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-534"><a href="#cb50-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-535"><a href="#cb50-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-536"><a href="#cb50-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-537"><a href="#cb50-537" aria-hidden="true" tabindex="-1"></a>¿Cuál seria el umbral adecuado?</span>
<span id="cb50-538"><a href="#cb50-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-539"><a href="#cb50-539" aria-hidden="true" tabindex="-1"></a>Punto de cruce entre sensitivity y specificity dado que se minimizan tanto FP y FN. Útil cuando no hay una clara preferencia por minimizar FP o FN.</span>
<span id="cb50-540"><a href="#cb50-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-543"><a href="#cb50-543" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-544"><a href="#cb50-544" aria-hidden="true" tabindex="-1"></a>sel_cutoff <span class="ot">=</span> <span class="fl">0.45</span></span>
<span id="cb50-545"><a href="#cb50-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-546"><a href="#cb50-546" aria-hidden="true" tabindex="-1"></a><span class="co"># calculamos las predicciones sobre el dataset de train</span></span>
<span id="cb50-547"><a href="#cb50-547" aria-hidden="true" tabindex="-1"></a>table_train <span class="ot">=</span> <span class="fu">augment</span>(<span class="at">x =</span> best_model, </span>
<span id="cb50-548"><a href="#cb50-548" aria-hidden="true" tabindex="-1"></a>                      <span class="at">newdata =</span> train,</span>
<span id="cb50-549"><a href="#cb50-549" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type.predict=</span><span class="st">'response'</span>)</span>
<span id="cb50-550"><a href="#cb50-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-551"><a href="#cb50-551" aria-hidden="true" tabindex="-1"></a><span class="co"># Clasificamos utilizamos el punto de corte</span></span>
<span id="cb50-552"><a href="#cb50-552" aria-hidden="true" tabindex="-1"></a>table_train <span class="ot">=</span> table_train <span class="sc">%&gt;%</span> </span>
<span id="cb50-553"><a href="#cb50-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted_class =</span> <span class="fu">if_else</span>(.fitted<span class="sc">&gt;</span>sel_cutoff, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>(), </span>
<span id="cb50-554"><a href="#cb50-554" aria-hidden="true" tabindex="-1"></a>         <span class="at">cardio =</span> <span class="fu">factor</span>(cardio))</span>
<span id="cb50-555"><a href="#cb50-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-556"><a href="#cb50-556" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos la matriz de confusión</span></span>
<span id="cb50-557"><a href="#cb50-557" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">table</span>(table_train<span class="sc">$</span>predicted_class, table_train<span class="sc">$</span>cardio), <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb50-558"><a href="#cb50-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-559"><a href="#cb50-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-562"><a href="#cb50-562" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-563"><a href="#cb50-563" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos la predicciones al dataset de testeo</span></span>
<span id="cb50-564"><a href="#cb50-564" aria-hidden="true" tabindex="-1"></a>table_test <span class="ot">=</span> <span class="fu">augment</span>(<span class="at">x =</span> best_model, </span>
<span id="cb50-565"><a href="#cb50-565" aria-hidden="true" tabindex="-1"></a>                     <span class="at">newdata=</span>test, </span>
<span id="cb50-566"><a href="#cb50-566" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type.predict=</span><span class="st">'response'</span>) </span>
<span id="cb50-567"><a href="#cb50-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-568"><a href="#cb50-568" aria-hidden="true" tabindex="-1"></a><span class="co"># Clasificamos utilizando el punto de corte</span></span>
<span id="cb50-569"><a href="#cb50-569" aria-hidden="true" tabindex="-1"></a>table_test <span class="ot">=</span> table_test <span class="sc">%&gt;%</span> </span>
<span id="cb50-570"><a href="#cb50-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted_class =</span> <span class="fu">if_else</span>(.fitted<span class="sc">&gt;</span>sel_cutoff, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb50-571"><a href="#cb50-571" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos la matriz de confusión</span></span>
<span id="cb50-572"><a href="#cb50-572" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">table</span>(table_test<span class="sc">$</span>predicted_class, table_test<span class="sc">$</span>cardio), <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb50-573"><a href="#cb50-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-574"><a href="#cb50-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-575"><a href="#cb50-575" aria-hidden="true" tabindex="-1"></a>El 69.8 % de los casos positivos reales fueron correctamente identificados.</span>
<span id="cb50-576"><a href="#cb50-576" aria-hidden="true" tabindex="-1"></a>(Probabilidad de detectar correctamente una ECV si la persona realmente la tiene.)</span>
<span id="cb50-577"><a href="#cb50-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-578"><a href="#cb50-578" aria-hidden="true" tabindex="-1"></a>El 66.4 % de los casos negativos fueron correctamente identificados como tales.</span>
<span id="cb50-579"><a href="#cb50-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-580"><a href="#cb50-580" aria-hidden="true" tabindex="-1"></a>De todos los que el modelo predijo como negativos, el 70.4 % realmente no tienen ECV.</span>
<span id="cb50-581"><a href="#cb50-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-584"><a href="#cb50-584" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-585"><a href="#cb50-585" aria-hidden="true" tabindex="-1"></a>best_model</span>
<span id="cb50-586"><a href="#cb50-586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-587"><a href="#cb50-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-588"><a href="#cb50-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-589"><a href="#cb50-589" aria-hidden="true" tabindex="-1"></a><span class="fu">### Gráfico de Hosmer Lemeshow</span></span>
<span id="cb50-590"><a href="#cb50-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-591"><a href="#cb50-591" aria-hidden="true" tabindex="-1"></a>Los gráficos de residuos vs predichos no son informativos para evaluar el ajuste del modelo, ya que la variable solo toma dos valores.</span>
<span id="cb50-592"><a href="#cb50-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-593"><a href="#cb50-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-594"><a href="#cb50-594" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>En el eje X se observa la probabilidad predicha de contrarer una ECV.</span>
<span id="cb50-595"><a href="#cb50-595" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-596"><a href="#cb50-596" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>En el eje Y se observa la frecuencia de clase, el cociente entre cantidad de individuos con ECV y el total de pacientes.</span>
<span id="cb50-597"><a href="#cb50-597" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-598"><a href="#cb50-598" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>La línea punteada designa la igualdad entre probabilidad predicha y frecuencia de clase.</span>
<span id="cb50-599"><a href="#cb50-599" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-600"><a href="#cb50-600" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>Los círculos, que se construyen de la siguiente manera:</span>
<span id="cb50-601"><a href="#cb50-601" aria-hidden="true" tabindex="-1"></a><span class="ss">      * </span>Se dividen a las observaciones en bins en base a la probabilidad predicha</span>
<span id="cb50-602"><a href="#cb50-602" aria-hidden="true" tabindex="-1"></a><span class="ss">      * </span>Se calcula la frecuencia de clase para cada bin</span>
<span id="cb50-603"><a href="#cb50-603" aria-hidden="true" tabindex="-1"></a><span class="ss">      * </span>En base a estas dos coordenadas se ubica al círculo en el gráfico</span>
<span id="cb50-604"><a href="#cb50-604" aria-hidden="true" tabindex="-1"></a><span class="ss">      * </span>El número y tamaño indican la cantidad de observaciones en dicho grupo</span>
<span id="cb50-605"><a href="#cb50-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-606"><a href="#cb50-606" aria-hidden="true" tabindex="-1"></a>Aquellos **círculos que se ubiquen por encima** de la línea punteada indican que el **modelo está subestimando** la probabilidad para dichos grupos. Mientras que si los **círculos se ubican por debajo** el modelo está **sobreestimando** la probabilidad para dichos grupos.</span>
<span id="cb50-607"><a href="#cb50-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-608"><a href="#cb50-608" aria-hidden="true" tabindex="-1"></a>¿Para qué valores parece existir una sobreestimación de la probabilidad? ¿Para cuáles subestimación?</span>
<span id="cb50-609"><a href="#cb50-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-612"><a href="#cb50-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-613"><a href="#cb50-613" aria-hidden="true" tabindex="-1"></a>Hosmer_Lemeshow_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, predicted_column, class_column, bins, positive_value, <span class="at">color=</span><span class="st">'forestgreen'</span>, <span class="at">nudge_x=</span><span class="dv">0</span>, <span class="at">nudge_y=</span><span class="fl">0.05</span>){</span>
<span id="cb50-614"><a href="#cb50-614" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asignar los grupos a las observaciones de acuerdo a la probabilidad predicha</span></span>
<span id="cb50-615"><a href="#cb50-615" aria-hidden="true" tabindex="-1"></a>  dataset[<span class="st">'group'</span>] <span class="ot">&lt;-</span> <span class="fu">bin</span>(dataset[predicted_column], <span class="at">nbins =</span> bins, <span class="at">method =</span> <span class="st">'l'</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>bins))</span>
<span id="cb50-616"><a href="#cb50-616" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Contar la cantidad de casos positivos por grupo</span></span>
<span id="cb50-617"><a href="#cb50-617" aria-hidden="true" tabindex="-1"></a>  positive_class <span class="ot">&lt;-</span> dataset <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(class_column)<span class="sc">==</span>positive_value) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span>
<span id="cb50-618"><a href="#cb50-618" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtener la media de las predicciones por grupo</span></span>
<span id="cb50-619"><a href="#cb50-619" aria-hidden="true" tabindex="-1"></a>  HL_df <span class="ot">&lt;-</span> dataset <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">pred=</span><span class="fu">mean</span>(<span class="sc">!!</span><span class="fu">sym</span>(predicted_column)), <span class="at">count=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb50-620"><a href="#cb50-620" aria-hidden="true" tabindex="-1"></a>            <span class="fu">inner_join</span>(.,positive_class) <span class="sc">%&gt;%</span></span>
<span id="cb50-621"><a href="#cb50-621" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">freq=</span>n<span class="sc">/</span>count)</span>
<span id="cb50-622"><a href="#cb50-622" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gráfico </span></span>
<span id="cb50-623"><a href="#cb50-623" aria-hidden="true" tabindex="-1"></a>  HM_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(HL_df, <span class="fu">aes</span>(<span class="at">x=</span>pred, <span class="at">y=</span>freq)) <span class="sc">+</span> </span>
<span id="cb50-624"><a href="#cb50-624" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>n), <span class="at">color=</span>color) <span class="sc">+</span></span>
<span id="cb50-625"><a href="#cb50-625" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>n),<span class="at">nudge_y =</span> nudge_y)<span class="sc">+</span></span>
<span id="cb50-626"><a href="#cb50-626" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="st">'dashed'</span>) <span class="sc">+</span> </span>
<span id="cb50-627"><a href="#cb50-627" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb50-628"><a href="#cb50-628" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Hosmer-Lemeshow'</span>, <span class="at">size=</span><span class="st">'Casos'</span>, <span class="at">x=</span><span class="st">"Probabilidad Predicha"</span>, <span class="at">y=</span><span class="st">"Frecuencia observada"</span>)</span>
<span id="cb50-629"><a href="#cb50-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(HM_plot)</span>
<span id="cb50-630"><a href="#cb50-630" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-631"><a href="#cb50-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-632"><a href="#cb50-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-635"><a href="#cb50-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-636"><a href="#cb50-636" aria-hidden="true" tabindex="-1"></a><span class="co"># modelo completo</span></span>
<span id="cb50-637"><a href="#cb50-637" aria-hidden="true" tabindex="-1"></a><span class="fu">Hosmer_Lemeshow_plot</span>(test_model, <span class="st">'.fitted'</span>, <span class="st">'cardio'</span>, <span class="dv">10</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb50-638"><a href="#cb50-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle=</span><span class="st">"Modelo final"</span>)</span>
<span id="cb50-639"><a href="#cb50-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-640"><a href="#cb50-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-641"><a href="#cb50-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-642"><a href="#cb50-642" aria-hidden="true" tabindex="-1"></a>La prueba de Hosmer Lemeshow permite evaluar el buen ajuste del modelo</span>
<span id="cb50-643"><a href="#cb50-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-646"><a href="#cb50-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-647"><a href="#cb50-647" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ResourceSelection)</span>
<span id="cb50-648"><a href="#cb50-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-649"><a href="#cb50-649" aria-hidden="true" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">hoslem.test</span> (test<span class="sc">$</span>cardio , </span>
<span id="cb50-650"><a href="#cb50-650" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">fitted</span>(best_model), <span class="at">g=</span><span class="dv">8</span>)</span>
<span id="cb50-651"><a href="#cb50-651" aria-hidden="true" tabindex="-1"></a>h1</span>
<span id="cb50-652"><a href="#cb50-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb50-653"><a href="#cb50-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-656"><a href="#cb50-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb50-657"><a href="#cb50-657" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una secuencia de valores para 'weight' y combinar con los niveles de 'cholesterol'</span></span>
<span id="cb50-658"><a href="#cb50-658" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb50-659"><a href="#cb50-659" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">seq</span>(<span class="fu">min</span>(train<span class="sc">$</span>weight), <span class="fu">max</span>(train<span class="sc">$</span>weight), <span class="at">length.out =</span> <span class="dv">150</span>),</span>
<span id="cb50-660"><a href="#cb50-660" aria-hidden="true" tabindex="-1"></a>  <span class="at">cholesterol =</span> <span class="st">"1"</span>,  <span class="co"># fijamos un valor para el género</span></span>
<span id="cb50-661"><a href="#cb50-661" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">levels</span>(train<span class="sc">$</span>gender)</span>
<span id="cb50-662"><a href="#cb50-662" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-663"><a href="#cb50-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-664"><a href="#cb50-664" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener probabilidades predichas del modelo</span></span>
<span id="cb50-665"><a href="#cb50-665" aria-hidden="true" tabindex="-1"></a>new_data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(best_model, <span class="at">newdata =</span> new_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb50-666"><a href="#cb50-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-667"><a href="#cb50-667" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar la función sigmoidea</span></span>
<span id="cb50-668"><a href="#cb50-668" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_data, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> predicted, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb50-669"><a href="#cb50-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb50-670"><a href="#cb50-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb50-671"><a href="#cb50-671" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Peso"</span>,</span>
<span id="cb50-672"><a href="#cb50-672" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probabilidad predicha de ECV"</span>,</span>
<span id="cb50-673"><a href="#cb50-673" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Predicciones según género"</span>,</span>
<span id="cb50-674"><a href="#cb50-674" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Género"</span></span>
<span id="cb50-675"><a href="#cb50-675" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb50-676"><a href="#cb50-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span>
<span id="cb50-677"><a href="#cb50-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-678"><a href="#cb50-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-679"><a href="#cb50-679" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copiar al portapapeles" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>